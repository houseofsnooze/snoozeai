FROM node:20-alpine AS node

FROM python:3.9-alpine

COPY --from=node /usr/lib /usr/lib
COPY --from=node /usr/local/lib /usr/local/lib
COPY --from=node /usr/local/include /usr/local/include
COPY --from=node /usr/local/bin /usr/local/bin

# # Install Node.js
# RUN apt-get update && \
#     apt-get install -y curl && \
#     curl -sL https://deb.nodesource.com/setup_20.x | bash - && \
#     apt-get install -y nodejs && \
#     apt-get clean && \
#     rm -rf /var/lib/apt/lists/*

# Verify installations
RUN python --version && node --version && npm --version

# Set the working directory
WORKDIR /app

# Copy the current directory contents into the container at /app
COPY . /app

# Install any needed packages specified in requirements.txt and package.json
# RUN pip install --no-cache-dir -r requirements.txt
RUN pip install -r requirements.txt
RUN npm install --prefix zzz/hh

# Make port 80 available to the world outside this container
EXPOSE 80
EXPOSE 8080

CMD ["python", "fury.py"]
# CMD ["uvicorn", "fury:app", "--host", "0.0.0.0", "--port", "80"]
# CMD ["fastapi", "dev", "fury.py"]
# If running behind a proxy like Nginx or Traefik add --proxy-headers
# CMD ["fastapi", "run", "app/main.py", "--port", "80", "--proxy-headers"]
